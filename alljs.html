<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kitchen Express</title>
    <link rel="stylesheet" href="/styles.css" />
    
  </head>

  <body>
    <header class="actions">
      <h1 class="sr-only">Kitchen Express</h1>
      <div class="actions__inner">
        <button class="button button_primary" data-add>Add Order</button>
      </div>
    </header>

    <dialog class="overlay" data-help-overlay>
      <h2 class="overlay__title">Help</h2>
      <p><strong>To use the app, you can start by adding a new order by clicking the "add order" button.</strong></p>
      <p>You can view and update orders by selecting them directly from the list. Inside the order, you can manually change information associated with an order or update its status. However, note that you can quickly change the status of an order by drag it between the three different columns with your mouse.</p>
      <div class="overlay__row">
        <button class="button" type="button" data-help-cancel>Close</button>
      </div>
    </dialog>

    <dialog class="overlay" data-add-overlay>
      <div class="overlay__top">
        <h2 class="overlay__title">Add Order</h2>
      </div>

      <form class="overlay__form" data-add-form id="add-form">
        <label class="overlay__field">
          <div class="overlay__label">Item</div>
          <input class="overlay__input" data-add-title name="title" required>
        </label>

        <label class="overlay__field">
          <div class="overlay__label">Table</div>
          <select class="overlay__input overlay__input_select" data-add-table name="table"></select>
        </label>

      </form>
      <div class="overlay__row">
        <button class="button" type="button" data-add-cancel>Cancel</button>
        <button class="button button_primary" type="submit"  form="add-form">Add</button>
      </div>
    </dialog>

    <dialog class="overlay" data-edit-overlay>
      <div class="overlay__top">
        <h2 class="overlay__title">Edit Order</h2>
        <button class="overlay__delete" data-edit-delete>Delete</button>
      </div>

      <form class="overlay__form" data-edit-form id="edit-form">
        <input hidden name="id" data-edit-id>

        <label class="overlay__field">
          <div class="overlay__label">Item</div>
          <input class="overlay__input" data-edit-title name="title" required>
        </label>

        <label class="overlay__field">
          <div class="overlay__label">Table</div>
          <select class="overlay__input overlay__input_select" data-edit-table name="table"></select>
        </label>

        <label class="overlay__field">
          <div class="overlay__label">Status</div>

          <select class="overlay__input overlay__input_select" data-edit-column name="column">
            <option value="ordered">Ordered</option>
            <option value="preparing">Preparing</option>
            <option value="served">Served</option>
          </select>
        </label>

      </form>
      <div class="overlay__row">
        <button class="button" type="button" data-edit-cancel>Cancel</button>
        <button class="button button_primary" type="submit" form="edit-form">Update</button>
      </div>
    </dialog>

    <h2 class="sr-only">Orders</h2>

    <div class="grid" data-grid>
      <section class="grid__column" data-area="ordered">
        <h2 class="grid__title">ü§µ Ordered</h2>
        <div class="grid__content" data-column="ordered"></div>
      </section>

      <section class="grid__column" data-area="preparing">
        <h2 class="grid__title">üë©‚Äçüç≥ Preparing</h2>
        <div class="grid__content" data-column="preparing"></div>
      </section>

      <section class="grid__column grid__column_last" data-area="served">
        <h2 class="grid__title">üë©‚Äçüíº Served</h2>
        <div class="grid__content" data-column="served"></div>
      </section>
    </div>

    <button class="help" data-help>?</button>
    <div class="backdrop"></div>


<script>

 const TABLES = [
    '1',
    '2',
    '3',
    '4',
    '5',
    '6',
    '7',
    '8',
    '9',
    '10',
    '11',
    '12',
    '13'
]

 const COLUMNS = [
    'ordered',
    'preparing',
    'served',
]


 const state = {
    orders: {},
    dragging: {
        source: null,
        over: null,
    }
}


const createUniqueId = () => {
    const random1 = Math.floor(Math.random() * 10000000000000000)
    const random2 = Math.floor(Math.random() * 10000000000000000)
    const timestamp = new Date().getTime()
    return `${random1}-${timestamp}-${random2}`
}


 const createOrderData = (props) => {
    const { title, table, column } = props

    return {
        title,
        table,
        column,
        id: createUniqueId(),
        created: new Date(),
    }
}


 const updateDragging = (newDragging) => {
    const { source = state.dragging.source, over = state.dragging.over } = newDragging
    if (over === state.dragging.over) return

    state.dragging = {
        source,
        over,
    }
}


 const createOrderHtml = (order) => {
    const { id, title, table, created } = order

    const element = document.createElement('div') // <div class="order" draggable="true" data-id="id"></div>
    element.className = 'order'
    element.draggable = true
    element.dataset.id = id

    const hours = created.getHours().toString().padStart(2, '0')
    const minutes = created.getMinutes().toString().padStart(2, '0')

    element.innerHTML = /* html */ `
        <div class="order__title" data-order-title>${title}</div>
        
        <dl class="order__details">
            <div class="order__row">
                <dt>Table:</dt>
                <dd class="order__value" data-order-table>${table}</dd>
            </div>

            <div class="order__row">
                <dt>Ordered:</dt>
                <dd class="order__value">${hours}:${minutes}</dd>
            </div>
        </dl>
    `

    return element
}


const createTableOptionsHtml = () => {
    const fragment = document.createDocumentFragment()

    for (const singleTable of TABLES) { //loop through tables ID
        const option = document.createElement('option')
        option.value = singleTable //1,2,3,4,5,6,7...
        option.innerText = singleTable
        fragment.appendChild(option)
    }

    return fragment
}

 const html = {
    columns: {}, //ordered, preparing, served
    area: {},//ordered, preparing, served
    add: {
        overlay: document.querySelector('[data-add-overlay]'),
        form: document.querySelector('[data-add-form]'),
        cancel: document.querySelector('[data-add-cancel]'),
        title: document.querySelector('[data-add-title]'),
        table: document.querySelector('[data-add-table]'),
    },
    edit: {
        overlay: document.querySelector('[data-edit-overlay]'),
        form: document.querySelector('[data-edit-form]'),
        cancel: document.querySelector('[data-edit-cancel]'),
        title: document.querySelector('[data-edit-title]'),
        table: document.querySelector('[data-edit-table]'),
        id: document.querySelector('[data-edit-id]'),
        column: document.querySelector('[data-edit-column]'),
        delete: document.querySelector('[data-edit-delete]')
    },
    help: {
        overlay: document.querySelector('[data-help-overlay]'),
        cancel: document.querySelector('[data-help-cancel]'),
    },
    other: {
        grid: document.querySelector('[data-grid]'),
        help: document.querySelector('[data-help]'),
        add: document.querySelector('[data-add]'),
        order: document.querySelector('[data-order]'),
    }
}

for (const columnName of COLUMNS) {
    html.columns[columnName] = document.querySelector(`[data-column="${columnName}"]`)
    html.area[columnName] = document.querySelector(`[data-area="${columnName}"]`)
}


 const updateDraggingHtml = (newDragging) => {
    const { over = state.dragging.over } = newDragging

    for (const columnName of COLUMNS) {
        const value = columnName === over ? 'rgba(0, 160, 70, 0.2)' : ''
        html.area[columnName].style.backgroundColor = value
    }
}


 const moveToColumn = (id, newColumn) => {
    const htmlSource = document.querySelector(`[data-id="${id}"]`) 
    const duplicate = htmlSource.cloneNode(true)
    html.columns[newColumn].appendChild(duplicate)
    htmlSource.remove()
}


html.other.add.focus()


html.add.table.appendChild(createTableOptionsHtml())
html.edit.table.appendChild(createTableOptionsHtml())




const handleDragOver = (event) => {
event.preventDefault();
const path = event.path || event.composedPath()
let column = null

for (const element of path) {
    const { area } = element.dataset
    if (area) {
        column = area
        break;
    }
}

if (!column) return
updateDraggingHtml({ over: column })
updateDraggingHtml({ over: column })
}


const handleDragStart = (event) => {}
const handleDragEnd = (event) => {}
const handleHelpToggle = (event) => {
const { target } = event

let helpOverlay = html.help.overlay
helpOverlay.style.display = 'block'

if (target === html.help.cancel) {
    helpOverlay.style.display = 'none';
  }

}
const handleAddToggle = (event) => { // clicking add order button
const { target } = event

let addOverlay = html.add.overlay

if (target === html.other.add) {
   addOverlay.style.display = 'block' 
   console.log("clicked add")
} else if (target === html.add.cancel) {
    addOverlay.style.display = 'none'
    console.log("clicked cancel")
}

}


const handleAddSubmit = (event) => { // clicking add button to add order
event.preventDefault()
const { target } = event
let addOverlay = html.add.overlay

addOverlay.style.display = 'none'
    
const data = {
    title: html.add.title.value,
    table: html.add.table.value,
    column: html.columns.ordered

}

// below is too add data to createOrderData function then
//generate html with creatOrderHTMl function
const fullOrder = createOrderHtml(createOrderData(data)) 

const orderedColumn = document.querySelector('[data-column="ordered"]')

if (target === html.add.form)
orderedColumn.append(fullOrder)
    console.log("clicked submit")
   
    html.add.form.reset()
}


const handleEditToggle = (event) => { // click actual order and cancel on edit overlay
const { target } = event
const editOverlay = html.edit.overlay
editOverlay.style.display = 'block'


const editTitle = document.querySelector('[data-order-title]').innerHTML
const editTable = document.querySelector('[data-order-table]').innerHTML

html.edit.title.value = editTitle
html.edit.table.value = editTable

if (target === html.edit.cancel) { //cancel edit
 editOverlay.style.display = 'none'
 console.log("clicked edit cancel")
}


}
const handleEditSubmit = (event) => { // submit the edited form
event.preventDefault()


console.log(handleAddSubmit())

}
const handleDelete = (event) => { //delete order

}

html.add.cancel.addEventListener('click', handleAddToggle)
html.other.add.addEventListener('click', handleAddToggle)
html.add.form.addEventListener('submit', handleAddSubmit)

html.other.grid.addEventListener('click', handleEditToggle) // clicking the atual order
html.edit.cancel.addEventListener('click', handleEditToggle) //cancel button
html.edit.form.addEventListener('submit', handleEditSubmit) // submit button
html.edit.delete.addEventListener('click', handleDelete) //delete 

html.help.cancel.addEventListener('click', handleHelpToggle)
html.other.help.addEventListener('click', handleHelpToggle)

for (const htmlColumn of Object.values(html.columns)) {
htmlColumn.addEventListener('dragstart', handleDragStart)
htmlColumn.addEventListener('dragend', handleDragEnd)
}

for (const htmlArea of Object.values(html.area)) {
htmlArea.addEventListener('dragover', handleDragOver)
}

</script>

</body>
</html>